### 3.1 엔티티 매니저 팩토리와 엔티티 매니저

**엔티티 매니저**

- 엔티티를 관리하는 관리자
- 엔티티를 저장하는 가상의 데이터베이스
- 트랜젝션 시작 시 커넥션 획득
- 여러 스레드 동시 접근시 동시성 문제 발생
- 생성 비용이 적음

<br>

**엔티티 팩토리 매니저**

```java
EntityManagerFactory emf 
= Persistence.createEntityManagerFactory("jpabook");
```

- 데이터베이스를 하나만 사용하는 애플리케이션은 일반적으로 EntityManagerFactory를 하나만 생성(생성 비용이 많이 들기 때문)
- Persistence.createEntityManagerFactory("jpabook") 호출 시 META-INF/persistence.xml에 있는 정보를 바탕으로 EntityManagerFactory 생성
- 필요 시마다 엔티티 매니저 팩토리에서 엔티티 매니저 생성하면 됨
    - 엔티티 매니저 팩토리
        - 엔티티 매니저 생성
        - 여러 스레드가 동시 접근해도 안전 → 다른 스레드간 공유 가능

<br><br>

### 3.2 영속성 컨텍스트란?

**영속성 컨텍스트**

- 엔티티를 영구 저장하는 환경
- 엔티티 매니저: 엔티티 저장 혹은 조회 → 영속성 컨텍스트에 엔티티 보관, 관리
- 여러 엔티티 매니저가 같은 영속성 컨텍스트에 접근 가능

```java
em.persist(member);
```

- persist() : 엔티티 매니저를 사용해 회원 엔티티를 영속성 컨텍스트에 저장

<br><br>

### 3.3 엔티티의 생명주기

**엔티티 4가지 상태**

![image](https://user-images.githubusercontent.com/93105083/175821623-3689a3d2-7644-4005-b7d8-4d8fe1cf6789.png)


- **비영속(new/transient)**
    - 객체를 생성만 한 상태. em.persist() 호출 전
    - 영속성 컨텍스트와 전혀 관계가 없는 상태
- **영속(managed)**
    - 엔티티 매니저를 통해 영속성 컨텍스트에 저장된 상태
    - em.persist() 호출 후
    - 영속성 컨텍스트가 관리하는 엔티티
- **준영속(detached)**
    - em.detach() 또는 em.close() 또는 em.clear()를 호출
    - 영속성 컨텍스트에 저장되었다가 분리된 상태
    - 영속상태의 엔티티를 영속성 컨텍스트가 관리하지 않는 상태
- **삭제(removed)**
    - em.remove()
    - 삭제된 상태

<br><br>

### 3.4 영속성 컨텍스트의 특징
