# JPA 영속성 관리

-----------

## JPA가 제공하는 기능
1. 엔티티와 테이블을 매핑하는 설계 부분 
2. 매핑한 엔티티를 실제 사용하는 부분

<br>

## 엔티티 매니저란?

>엔티티를 저장하고, 수정하고, 삭제하고, 조회하는 등 **엔티티와 관련된 모든 일**을 처리
>> ex) 엔티티를 저장하는 가상의 데이터베이스

<br>

## 엔티티 매니저 팩토리 

- 엔티티 매니저를 만드는 공장.
  - 공장을 만드는 비용은 상당히 큼
    - 한 개만 만들어서 애플리케이션 전체에서 공유하도록 설계
  
```
// 공장 만들기, 비용이 아주 많이 듦
EntityManagerFactory emf = Persistence.createEntityManagerFacotry("jpabook");

// 공장에서 엔티티 매니저 생성, 비용이 거의 안 든다.
Entitymanager em = emf.createEntityManager();
```

 - **엔티티 매니저 팩토리**는 여러 스레드가 동시에 접근해도 안전 -> _서로 다른 스레드 간에 공유 가능_
 - **엔티티 매니저**는 여러 스레드가 동시에 접근하면 동시성 문제가 발생 -> _스레드 간에 공유 x_


<br>
<br>

----------------------------------------------------

## 영속성 컨텍스트

>**엔티티를 영구 저장하는 환경**
> 
> - 엔티티 매니저로 엔티티를 저장하거나 조회하면 엔티티 매니저는 영속성 컨텍스트에 엔티티를 보관하고 관리한다. 

```
em.persist(member);
// persist() => 엔티티 매니저를 사용해서 회원 엔티티를 영속성 컨텍스트에 저장
```


<br>
<br>

## 엔티티의 생명주기

#### - 비영속 : 영속성 컨텍스트와 전혀 관계가 없는 상태
#### - 영속 : 영속성 컨텍스트에 저장된 상태
#### - 준영속 : 영속성 컨텍스트에 저장되었다가 분리된 상태
#### - 삭제 : 삭제된 상태

![img.png](img.png)

<br>

### 비영속
> 엔티티 객체를 생성 -> 저장하지 않은 상태 -> 영속성 컨텍스트나 데이터 베이스와 관계가 없는 상태

<br>

### 영속
> 엔티티 매니저를 통해 엔티티를 영속성 컨텍스트에 저장 = **영속성 컨텍스트가 관리하는 엔티티** 

<br>

